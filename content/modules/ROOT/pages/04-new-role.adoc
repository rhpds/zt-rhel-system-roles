:imagesdir: ../assets/images

== Add a new role

In this step, you will be making changes to the playbook. To refresh
your memory, take a look at the initial playbook included by the lab.

[source,bash,run]
----
cat soe.yml
----

Now, add an additional configuration so that the timesync role can be
used by the playbook. Add the listing for the new role to the bottom of
the playbook.

[source,bash,run]
----
echo "    - role: rhel-system-roles.timesync" >> soe.yml
----

Now that the timesync role is configured in the playbook, you can add
settings in the variable section to be used by this role. In the command
below, sed is used to add the `+timesync_ntp_servers+` section and
hostname and iburst variables to the playbook.

[source,bash,run]
----
sed -ie 's/tlog_scope_sssd: all/tlog_scope_sssd: all\n    timesync_ntp_servers:\n      - hostname: time-d-b.nist.gov\n        iburst: yes\n      - hostname: 0.rhel.pool.ntp.org\n        iburst: yes/' soe.yml
----

Take a look at the updated playbook.

[source,bash,run]
----
cat soe.yml
----

.Updated soe.yml
image::soe-yaml-updated-timesync.png[Updated soe.yml]

When the playbook is next run, the system should be configured to use
the time-d-b.nist.gov and a timeserver from the pool at ntp.org.

Before running the playbook, verify the current settings being used by
the system with `+chronyc+`.

[source,bash,run]
----
ssh client1 chronyc sources
----

.Chronyc sources output
image::chronyc-sources-output.png[Chronyc sources output for client1]

Now execute the updated playbook to apply the changes you have added.

[source,bash,run]
----
ansible-playbook soe.yml -i hosts.ini
----

From the above snippet of output, you can see that only 4 items were
changed once the playbook was executed. These changes should have been
the updated time server settings.

You can verify that your system now uses the updated timeserver settings
by using `+chronyc+`.

[source,bash,run]
----
ssh client1 chronyc sources
----

.Chronyc sources output for client1
image::chronyc-sources-output-updated.png[Chronyc sources output for client1]

As expected, the system is now configured to use time-d-b.nist.gov and a
system assigned from the pool at ntp.org.
