:imagesdir: ../assets/images

== Inspect the playbook

To get started, an already created playbook has been created that uses
both the kernel-settings and session recording system roles. You can
inspect the contents of this lab provided playbook to get some more
information about what it will do on your system.

[source,bash,run]
----
cat soe.yml
----

The output should look like this.

.SOE playbook
image::soe-yaml.png[SOE playbook]

From the above output, this playbook will only affect `+localhost+`.
Also, at the bottom, you will notice the roles included,
`+kernel_settings+` and `+tlog+` (session recording) in the playbook.
Because these are the only roles included in the playbook, the `+vars+`
section has variables that are used by these roles.

The `+vars+` under the `+kernel_settings_sysctl+` section are the values of
parameters to set on the system to change kernel tunables in the
`+/proc/sys+` directory structure. The `+tlog_scope_sssd+` setting will enable
session recording for all users on the system.

Before you run the playbook and adjust the settings of the system,
verify the current setting for one of the playbook affected values
`+vm.swappiness+`.

[source,bash,run]
----
cat /proc/sys/vm/swappiness
----

The output should be

.Current swappiness value
image::swappiness-output.png[Current swappiness value]

Let's run the playbook to apply the system roles to `+localhost+`.

[source,bash,run]
----
ansible-playbook soe.yml
----

.Playbook run
image::playbook-run.png[Playbook run]

After you run the playbook, the swappiness value should be updated to be
20. You can verify this by running the following command.

[source,bash,run]
----
cat /proc/sys/vm/swappiness
----

.Updated swappiness value
image::swappiness-updated.png[Updated swappiness value]

NOTE: swappiness is a setting that determines the kernel’s preference
for using swap space on the system, the value is between 0-100. The
smaller the value, the less preference the kernel has for utilizing swap
space.

Let’s apply these roles to `+client1+`. We need to create a `+hosts.ini+` file specifying the hostname `+client1+`. This host will be part of the `+clients+` group. For localhost, we’ll specify that ansible should execute the playbook locally.

[source,bash,run]
----
cat > hosts.ini << EOF
localhost  ansible_connection=local
[clients]
client1
EOF
----

[source,bash,run]
----
cat hosts.ini
----

The `+hosts.ini+` should contain the following.

.hosts.ini
image::hosts-ini.png[hosts.ini]

Edit the `+soe.yml+` playbook to add the `+clients+` host group. This
tells ansible to apply the system roles in `+soe.yml+` to `+localhost+`
and `+client1+`.

[source,bash,run]
----
sed -i '/^- hosts: localhost/ s/$/, clients/' soe.yml
----

Check the soe.yml file.

[source,bash,run]
----
cat soe.yml
----

Here's the updated soe.yml file.

.Updated soe.yml
image::soe-yaml-updated.png[Updated soe.yml]

Now run the playbook again to apply the system roles to the clients
group.

[source,bash,run]
----
ansible-playbook soe.yml -i hosts.ini
----
